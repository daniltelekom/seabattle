<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SeaStrike — DEBUG test</title>
<style>
  body{font-family:system-ui,Arial;margin:12px;background:#eef8ff;color:#062;display:flex;flex-direction:column;gap:12px}
  .row{display:flex;gap:12px;align-items:flex-start}
  .panel{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,20,60,0.06)}
  .grid{display:grid;grid-template-columns:repeat(10,32px);gap:4px;padding:8px;background:#f6fbff;border-radius:8px}
  .cell{width:32px;height:32px;background:#dfefff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;user-select:none}
  .cell.occupied{background:#2b9cff;color:#fff}
  .cell.hit{background:#f44336;color:#fff}
  .cell.miss{background:#eee}
  button{padding:8px 10px;border-radius:8px;border:none;background:#1976d2;color:#fff;cursor:pointer}
  button.secondary{background:#607d8b}
  #dbg{position:fixed;right:8px;top:8px;background:rgba(0,0,0,0.8);color:#fff;padding:8px;border-radius:8px;max-width:40%;font-size:12px;white-space:pre-wrap;z-index:999}
</style>
</head>
<body>
  <h3>SeaStrike — DEBUG minimal</h3>

  <div class="row">
    <div class="panel" id="leftPanel">
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <button id="createBtn">Create</button>
        <button id="joinBtn">Join</button>
        <button id="readyBtn" class="secondary">Ready</button>
        <button id="autoBtn" class="secondary">Auto place</button>
      </div>
      <div style="margin-bottom:8px">Enemy field (click to shoot)</div>
      <div id="enemy" class="grid"></div>
    </div>

    <div class="panel" id="rightPanel">
      <div style="margin-bottom:8px">My field (place ships)</div>
      <div id="my" class="grid"></div>
      <div style="margin-top:8px">
        <label>Selected ship size:
          <select id="shipSize">
            <option value="4">4</option>
            <option value="3" selected>3</option>
            <option value="2">2</option>
            <option value="1">1</option>
          </select>
        </label>
        <button id="rotateBtn" class="secondary">Rotate H/V</button>
      </div>
    </div>
  </div>

  <div id="dbg" style="display:block">DBG: loading...</div>

<script>
(function(){
  const dbg = document.getElementById('dbg');
  function log(...args){ dbg.innerText = 'DBG: ' + args.map(a=> typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' | '); console.log(...args); }

  const enemy = document.getElementById('enemy');
  const my = document.getElementById('my');
  const createBtn = document.getElementById('createBtn');
  const joinBtn = document.getElementById('joinBtn');
  const readyBtn = document.getElementById('readyBtn');
  const autoBtn = document.getElementById('autoBtn');
  const shipSizeSelect = document.getElementById('shipSize');
  const rotateBtn = document.getElementById('rotateBtn');

  let orientation = 'H';
  let shipsPlaced = [];

  // build grids
  function build(gridEl){
    gridEl.innerHTML = '';
    for(let i=0;i<100;i++){
      const c = document.createElement('div');
      c.className = 'cell';
      c.dataset.idx = i;
      gridEl.appendChild(c);
    }
  }

  build(enemy); build(my);
  log('Grids built');

  // enemy click handler (shoot)
  enemy.addEventListener('click', (e)=>{
    const c = e.target;
    if(!c || !c.dataset) return;
    const idx = Number(c.dataset.idx);
    log('enemy click idx', idx);
    // simulate result random
    if(c.classList.contains('hit') || c.classList.contains('miss')){ log('already shot here'); return; }
    const r = Math.random();
    if(r < 0.3){ c.classList.add('hit'); log('result: hit', idx); }
    else { c.classList.add('miss'); log('result: miss', idx); }
  });

  // place ship on my field by clicking
  my.addEventListener('click', (e)=>{
    const c = e.target;
    if(!c || !c.dataset) return;
    const idx = Number(c.dataset.idx);
    const size = Number(shipSizeSelect.value);
    log('placing size', size, 'at', idx, 'orient', orientation);
    // try to place horizontally/vertically
    const x = idx % 10, y = Math.floor(idx/10);
    const cells = [];
    if(orientation === 'H'){
      if(x + size - 1 > 9){ log('out of bounds'); return; }
      for(let k=0;k<size;k++) cells.push((y*10)+(x+k));
    } else {
      if(y + size - 1 > 9){ log('out of bounds'); return; }
      for(let k=0;k<size;k++) cells.push(((y+k)*10)+x);
    }
    // check overlap
    const occupied = new Set(shipsPlaced.flatMap(s=>s.cells));
    for(const ci of cells) if(occupied.has(ci)){ log('overlap'); return; }
    // mark
    shipsPlaced.push({ id:shipsPlaced.length+1, size, cells, orientation });
    cells.forEach(ci => { my.children[ci].classList.add('occupied'); });
    log('placed', cells);
  });

  rotateBtn.addEventListener('click', ()=>{ orientation = (orientation === 'H') ? 'V' : 'H'; log('orientation', orientation); });

  autoBtn.addEventListener('click', ()=> {
    // simple clear + random placement
    shipsPlaced = [];
    document.querySelectorAll('#my .cell').forEach(c=> c.classList.remove('occupied'));
    const sizes = [4,3,3,2,2,2,1,1,1,1];
    for(const s of sizes){
      let tries = 0, ok=false;
      while(tries < 400 && !ok){
        const start = Math.floor(Math.random()*100);
        const orient = Math.random() < 0.5 ? 'H' : 'V';
        const x = start % 10, y = Math.floor(start/10);
        const cells = [];
        if(orient === 'H'){
          if(x + s - 1 > 9){ tries++; continue; }
          for(let k=0;k<s;k++) cells.push((y*10)+(x+k));
        } else {
          if(y + s - 1 > 9){ tries++; continue; }
          for(let k=0;k<s;k++) cells.push(((y+k)*10)+x);
        }
        const occupied = new Set(shipsPlaced.flatMap(s=>s.cells));
        if(cells.some(ci => occupied.has(ci))){ tries++; continue; }
        shipsPlaced.push({ id: shipsPlaced.length+1, size: s, cells, orientation: orient });
        cells.forEach(ci => my.children[ci].classList.add('occupied'));
        ok = true;
      }
    }
    log('auto placed', shipsPlaced.length, 'ships');
  });

  createBtn.addEventListener('click', ()=> log('create clicked - (no server in this test)'));
  joinBtn.addEventListener('click', ()=> log('join clicked - (no server in this test)'));
  readyBtn.addEventListener('click', ()=> log('ready clicked - ships count: ' + shipsPlaced.length));

  // final sanity log
  log('DEBUG page initialized. Click fields and buttons.');
})();
</script>
</body>
</html>
