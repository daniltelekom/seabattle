<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SeaStrike — quick test</title>
<style>
  body{font-family:system-ui,Arial;margin:12px;background:#eef8ff;color:#102;display:flex;flex-direction:column;gap:12px;min-height:100vh}
  .panel{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,20,60,0.06)}
  .grid{display:grid;grid-template-columns:repeat(10,32px);gap:4px;padding:8px;background:#f6fbff;border-radius:8px}
  .cell{width:32px;height:32px;background:#dfefff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;user-select:none}
  .cell.occupied{background:#2b9cff;color:#fff}
  .cell.hit{background:#f44336;color:#fff}
  .cell.miss{background:#eee}
  button{padding:8px 10px;border-radius:8px;border:none;background:#1976d2;color:#fff;cursor:pointer}
  button.secondary{background:#607d8b}
  #dbg{position:fixed;right:8px;top:8px;background:rgba(0,0,0,0.8);color:#fff;padding:8px;border-radius:8px;max-width:40%;font-size:12px;white-space:pre-wrap;z-index:999}
  @media (max-width:480px){
    .grid{grid-template-columns:repeat(10,calc((100vw - 60px)/10));}
    .cell{width:calc((100vw - 60px)/10);height:calc((100vw - 60px)/10)}
  }
</style>
</head>
<body>
  <h3>SeaStrike — TEST</h3>

  <div class="panel">
    <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
      <button id="createBtn">Create</button>
      <button id="joinBtn">Join</button>
      <button id="readyBtn" class="secondary">Ready</button>
      <button id="autoBtn" class="secondary">Auto place</button>
      <label style="margin-left:8px">Ship:
        <select id="shipSize">
          <option value="4">4</option>
          <option value="3" selected>3</option>
          <option value="2">2</option>
          <option value="1">1</option>
        </select>
      </label>
      <button id="rotateBtn" class="secondary">Rotate H/V</button>
    </div>

    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px">
        <div style="margin-bottom:8px">Enemy field (click to shoot)</div>
        <div id="enemy" class="grid"></div>
      </div>
      <div style="width:260px;min-width:200px">
        <div style="margin-bottom:8px">My field (place ships)</div>
        <div id="my" class="grid"></div>
      </div>
    </div>
  </div>

  <div id="dbg">DBG: starting...</div>

<script>
(function(){
  // --- debug logger visible on page
  const dbg = document.getElementById('dbg');
  function log(...a){ try{ dbg.innerText = 'DBG: ' + a.map(x => (typeof x === 'object' ? JSON.stringify(x) : String(x))).join(' | '); }catch(e){ dbg.innerText = 'DBG error'; } console.log(...a); }

  const enemy = document.getElementById('enemy');
  const my = document.getElementById('my');
  const createBtn = document.getElementById('createBtn');
  const joinBtn = document.getElementById('joinBtn');
  const readyBtn = document.getElementById('readyBtn');
  const autoBtn = document.getElementById('autoBtn');
  const rotateBtn = document.getElementById('rotateBtn');
  const shipSizeSel = document.getElementById('shipSize');

  let orientation = 'H';
  let placed = [];

  // build grid cells
  function buildGrid(container){
    container.innerHTML = '';
    for(let i=0;i<100;i++){
      const c = document.createElement('div');
      c.className = 'cell';
      c.dataset.idx = i;
      container.appendChild(c);
    }
  }

  buildGrid(enemy);
  buildGrid(my);
  log('grids built');

  // helpers
  function coords(idx){ return { x: idx % 10, y: Math.floor(idx / 10) }; }
  function cellIndex(x,y){ return y*10 + x; }

  function canPlace(startIdx, size, orient){
    const p = coords(startIdx);
    const cells = [];
    if(orient === 'H'){
      if(p.x + size -1 > 9) return {ok:false, reason:'out'};
      for(let k=0;k<size;k++) cells.push(cellIndex(p.x+k, p.y));
    } else {
      if(p.y + size -1 > 9) return {ok:false, reason:'out'};
      for(let k=0;k<size;k++) cells.push(cellIndex(p.x, p.y+k));
    }
    const occupied = new Set(placed.flatMap(s => s.cells));
    for(const c of cells) if(occupied.has(c)) return {ok:false, reason:'overlap'};
    return {ok:true, cells};
  }

  // my grid click -> place ship
  my.addEventListener('click', (e)=>{
    const el = e.target;
    if(!el.dataset || !el.dataset.idx) return;
    const idx = Number(el.dataset.idx);
    const size = Number(shipSizeSel.value);
    const res = canPlace(idx, size, orientation);
    if(!res.ok){ log('cannot place', res.reason); return; }
    placed.push({id:placed.length+1, size, cells: res.cells, orientation});
    res.cells.forEach(ci => my.children[ci].classList.add('occupied'));
    log('placed', res.cells);
  });

  // enemy click -> shoot
  enemy.addEventListener('click', (e)=>{
    const el = e.target;
    if(!el.dataset || !el.dataset.idx) return;
    const idx = Number(el.dataset.idx);
    if(el.classList.contains('miss') || el.classList.contains('hit')){ log('already shot'); return; }
    // fake result
    const r = Math.random();
    if(r < 0.3){ el.classList.add('hit'); log('hit at', idx); }
    else { el.classList.add('miss'); log('miss at', idx); }
  });

  // auto place
  autoBtn.addEventListener('click', ()=>{
    placed = [];
    document.querySelectorAll('#my .cell').forEach(c=> c.classList.remove('occupied'));
    const sizes = [4,3,3,2,2,2,1,1,1,1];
    for(const s of sizes){
      let tries = 0, done=false;
      while(tries < 500 && !done){
        const start = Math.floor(Math.random()*100);
        const orient = Math.random()<0.5 ? 'H' : 'V';
        const check = canPlace(start, s, orient);
        if(check.ok){ placed.push({id:placed.length+1, size:s, cells:check.cells, orientation:orient}); check.cells.forEach(ci=> my.children[ci].classList.add('occupied')); done=true; }
        tries++;
      }
    }
    log('auto placed', placed.length);
  });

  rotateBtn.addEventListener('click', ()=>{ orientation = (orientation==='H')?'V':'H'; log('orientation', orientation); });

  createBtn.addEventListener('click', ()=> log('create clicked (no server in test)'));
  joinBtn.addEventListener('click', ()=> log('join clicked (no server in test)'));
  readyBtn.addEventListener('click', ()=> log('ready clicked, ships placed: '+ placed.length));

  log('test script ready');
})();
</script>
</body>
</html>
