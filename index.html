<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SeaStrike</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 16px;
      background: #f5f5f5;
      color: #333;
    }
    .container { max-width: 500px; margin: 0 auto; }
    .status { 
      text-align: center; 
      margin-bottom: 16px; 
      font-weight: bold; 
      color: #1976d2;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 2px;
      margin-bottom: 16px;
    }
    .cell {
      aspect-ratio: 1;
      background: #bbdefb;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      user-select: none;
    }
    .cell.hit { background: #f44336; }
    .cell.miss { background: #e0e0e0; }
    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }
    .btn:disabled {
      background: #90caf9;
      cursor: not-allowed;
    }
    .avatar {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ccc;
      border: 2px solid #gold;
      overflow: hidden;
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="status" class="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div class="grid" id="board"></div>
    <button id="attackBtn" class="btn" disabled>–ê—Ç–∞–∫–æ–≤–∞—Ç—å (–¥–æ–∂–¥–∏—Ç–µ—Å—å –º–∞—Ç—á–∞)</button>
  </div>

  <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –≤ Telegram
    if (!window.Telegram?.WebApp) {
      document.body.innerHTML = '<h2>‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ –∏–≥—Ä—É —á–µ—Ä–µ–∑ Telegram!</h2>';
      throw new Error("Not in Telegram WebApp");
    }

    const WebApp = Telegram.WebApp;
    WebApp.expand();
    WebApp.setHeaderColor('#1976d2');
    WebApp.setBackgroundColor('#f5f5f5');

    // === –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===
    const initData = WebApp.initDataUnsafe;
    const user = initData?.user;
    if (!user) {
      WebApp.showAlert("–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
      WebApp.close();
    }

    const userId = user.id;
    const username = user.username || user.first_name || "–ò–≥—Ä–æ–∫";
    const photoUrl = user.photo_url || null;

    // === URL –ë–≠–ö–ê ===
    const BACKEND_URL = "https://replit.com/@daniltelekom/IndigoComposedAddin"; // ‚Üê –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô!

    // === –ê–í–ê–¢–ê–†–ö–ê –í –£–ì–õ–£ ===
    if (photoUrl) {
      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.innerHTML = `<img src="${photoUrl}" alt="avatar">`;
      document.body.appendChild(avatar);
    }

    // === –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –í –ë–î ===
    fetch(`${BACKEND_URL}/player`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        telegram_id: userId,
        username: username
      })
    })
    .then(r => r.json())
    .then(player => {
      document.getElementById('status').innerText = 
        `üéÆ ${username} | –†–µ–π—Ç–∏–Ω–≥: ${player.rating}`;
    })
    .catch(err => {
      console.error(err);
      document.getElementById('status').innerText = "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è";
    });

    // === –°–û–ó–î–ê–Å–ú –ü–û–õ–ï 10√ó10 ===
    const board = document.getElementById('board');
    for (let i = 0; i < 100; i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.idx = i;
      cell.innerText = i < 10 ? '0' + i : i;
      cell.onclick = () => {
        if (!cell.classList.contains('hit') && !cell.classList.contains('miss')) {
          cell.style.backgroundColor = '#ffeb3b';
          // –ó–¥–µ—Å—å –ø–æ–∑–∂–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞—Ç–∞–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        }
      };
      board.appendChild(cell);
    }

    // === –ö–ù–û–ü–ö–ê –ê–¢–ê–ö–ò (–≤—Ä–µ–º–µ–Ω–Ω–æ) ===
    const btn = document.getElementById('attackBtn');
    btn.onclick = () => {
      WebApp.showAlert("–ê—Ç–∞–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)");
    };

    // –ì–æ—Ç–æ–≤–æ!
    console.log("SeaStrike Mini App –∑–∞–≥—Ä—É–∂–µ–Ω–æ");
  </script>
</body>
</html>
